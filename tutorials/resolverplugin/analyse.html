

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Analyse the Target Site &mdash; XBMC Helper Modules v0.1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="XBMC Helper Modules v0.1.0 documentation" href="../../index.html" />
    <link rel="up" title="How to Write a urlresolver Plugin" href="index.html" />
    <link rel="next" title="Coding the Plugin" href="code.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="code.html" title="Coding the Plugin"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">XBMC Helper Modules v0.1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">How to Write a <tt class="docutils literal docutils literal"><span class="pre">urlresolver</span></tt> Plugin</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="analyse-the-target-site">
<h1>Analyse the Target Site<a class="headerlink" href="#analyse-the-target-site" title="Permalink to this headline">¶</a></h1>
<p>The first step in writing a resolver plugin (after choosing the site of
course!) is to analyse the target site to see how it works. Remember, your
plugin will be passed a URL to a web page on your target site and your code
must be able to turn that into the direct URL to the media file or stream.</p>
<div class="section" id="first-look">
<h2>First Look<a class="headerlink" href="#first-look" title="Permalink to this headline">¶</a></h2>
<p>Our target site is <a class="reference external" href="http://videobb.com">http://videobb.com</a> so let&#8217;s start by looking at a video on
that site.</p>
<p>The front page contains links to some videos so that is probably a good place
to start. Notice they are in the form <tt class="docutils literal"><span class="pre">http://videobb.com/video/{VIDEO_ID}</span></tt> so
this is definitely going to be a pattern we want to advertise our plugin as
capable of handling. The video id seems to comprise of numbers and both lower
and upper case letters (or in regex terms <tt class="docutils literal"><span class="pre">[0-9A-Za-z]</span></tt>).</p>
<p>Clicking on one of these links (I chose <a class="reference external" href="http://videobb.com/video/8FvAG6AQpHi8">http://videobb.com/video/8FvAG6AQpHi8</a>)
notice that you get diverted to
<tt class="docutils literal"><span class="pre">http://videobb.com/watch_video.php?v={VIDEO_ID}</span></tt> (in my case
<a class="reference external" href="http://videobb.com/watch_video.php?v=8FvAG6AQpHi8">http://videobb.com/watch_video.php?v=8FvAG6AQpHi8</a>). Another pattern we&#8217;ll
want to be able to handle.</p>
</div>
<div class="section" id="are-we-human">
<h2>Are We Human?<a class="headerlink" href="#are-we-human" title="Permalink to this headline">¶</a></h2>
<p>Notice there appears to be no &#8216;Are you human?&#8217; verification that there is with
many sites. This could be because we have clicked through from their front page
which may have set a cookie or the referrer header to the right value.</p>
<p>Lets test that out. Start by opening an incognito window of Chrome. This is a
handy trick to ensure that no cookies are left over from previous visits without
having to keep clear them out.</p>
<p>Now paste the URL to the video page
(<a class="reference external" href="http://videobb.com/watch_video.php?v=8FvAG6AQpHi8">http://videobb.com/watch_video.php?v=8FvAG6AQpHi8</a>) into the URL bar and hit
enter. Looks like it works so I guess they don&#8217;t do any checking at all - nice!</p>
<p>If you find your host does require that you prove you are human, often this is
just a case of sending some cookies, or posting some form values.</p>
</div>
<div class="section" id="finding-the-media-url">
<h2>Finding the Media URL<a class="headerlink" href="#finding-the-media-url" title="Permalink to this headline">¶</a></h2>
<p>Now the fun part!</p>
<p>Open the developer tools of Chrome (Shift + Ctrl + I), open the &#8216;Network&#8217; tab
and reload the page. You should see a list of all the files that page loads.</p>
<p>Click on the play button of the flash video and you&#8217;ll see some extra activity
in the network tab.</p>
<div class="figure align-center">
<img alt="../../_images/rp1.png" src="../../_images/rp1.png" />
<p class="caption">Spot the useful file....</p>
</div>
<p>Ah, one of those has a mime type of <tt class="docutils literal"><span class="pre">video/x-flv</span></tt> - that has to be our video!
Clicking on that entry shows that the request URL is
<tt class="docutils literal"><span class="pre">http://s153.videobb.com/s?v=8FvAG6AQpHi8&amp;r=2&amp;t=1313232595&amp;u=&amp;c=11885AACE290D85BA5F8CB5B6430028F9642DA1BF9CA4D6809490FCFE023E07C&amp;start=0</span></tt>.</p>
<p>It looks like <tt class="docutils literal"><span class="pre">t</span></tt> is a Unix timestamp, and <tt class="docutils literal"><span class="pre">c</span></tt> looks like an access token,
so this will probably be different for you. Indeed you can try reloading the
page and pressing play again and you&#8217;ll see the URL is different.</p>
</div>
<div class="section" id="where-is-it-hidden">
<h2>Where is it Hidden?<a class="headerlink" href="#where-is-it-hidden" title="Permalink to this headline">¶</a></h2>
<p>A quick search of the page source shows that this URL isn&#8217;t just included in the
HTML. I guess they didn&#8217;t want to make it <em>too</em> easy.</p>
<p>Looking through the HTML of the page (use the &#8216;Resources&#8217; tab) you can see
where the code is to embed the flash player, so lets take a look at that:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;flashframe&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;video_player&quot;</span> <span class="na">id=</span><span class="s">&quot;videoPlayer&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
    <span class="nx">swfobject</span><span class="p">.</span><span class="nx">registerObject</span><span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;9.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;/player/expressInstall.swf&quot;</span><span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;object</span> <span class="na">width=</span><span class="s">&quot;982&quot;</span> <span class="na">height=</span><span class="s">&quot;462&quot;</span> <span class="na">id=</span><span class="s">&quot;base&quot;</span> <span class="na">classid=</span><span class="s">&quot;clsid:D27CDB6E-AE6D-11cf-96B8-444553540000&quot;</span> <span class="na">style=</span><span class="s">&quot;visibility: visible;&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;/player/player.swf?pv=1_1_78&quot;</span> <span class="na">name=</span><span class="s">&quot;movie&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;setting=aHR0cDovL3ZpZGVvYmIuY29tL3BsYXllcl9jb250cm9sL3NldHRpbmdzLnBocD92PThGdkFHNkFRcEhpOA==&quot;</span> <span class="na">name=</span><span class="s">&quot;FlashVars&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="na">name=</span><span class="s">&quot;allowfullscreen&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;always&quot;</span> <span class="na">name=</span><span class="s">&quot;allowscriptaccess&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;transparent&quot;</span> <span class="na">name=</span><span class="s">&quot;wmode&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;embed</span> <span class="na">src=</span><span class="s">&quot;/player/player.swf?pv=1_1_78&quot;</span> <span class="na">flashvars=</span><span class="s">&quot;setting=aHR0cDovL3ZpZGVvYmIuY29tL3BsYXllcl9jb250cm9sL3NldHRpbmdzLnBocD92PThGdkFHNkFRcEhpOA==&quot;</span> <span class="na">type=</span><span class="s">&quot;application/x-shockwave-flash&quot;</span> <span class="na">allowscriptaccess=</span><span class="s">&quot;always&quot;</span> <span class="na">allowfullscreen=</span><span class="s">&quot;true&quot;</span> <span class="na">width=</span><span class="s">&quot;982&quot;</span> <span class="na">height=</span><span class="s">&quot;462&quot;</span> <span class="na">wmode=</span><span class="s">&quot;transparent&quot;</span> <span class="na">name=</span><span class="s">&quot;ESAHDMP&quot;</span><span class="nt">&gt;&lt;/embed&gt;</span>
    <span class="nt">&lt;/object&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p>Notice the <tt class="docutils literal"><span class="pre">value=&quot;setting=aHR0cDovL3ZpZGVvYmIu....</span></tt> part? This looks
suspiciously like a <a class="reference external" href="http://en.wikipedia.org/wiki/Base64">base64</a> encoded URL
(the <tt class="docutils literal"><span class="pre">=</span></tt> used as padding at the end are a giveaway, although not always
present in a base64 encoded string, and strings staring with &#8216;<a class="reference external" href="http://">http://</a>&#8216; will
always encode to a value starting &#8216;aHR0cD...&#8217;).</p>
<p>We can check this out using an online decoder such as
<a class="reference external" href="http://base64decode.org/">http://base64decode.org/</a>, or even using the python interactive interpretor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;aHR0cDovL3ZpZGVvYmIuY29tL3BsYXllcl9jb250cm9sL3NldHRpbmdzLnBocD92PThGdkFHNkFRcEhpOA==&#39;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;base-64&#39;</span><span class="p">)</span>
<span class="go">&#39;http://videobb.com/player_control/settings.php?v=8FvAG6AQpHi8&#39;</span>
</pre></div>
</div>
<p>Looks like we will be able to generate that URL without having to load the video
page. Lets see what it contains. If you load that URL in the browser you&#8217;ll see
it is <a class="reference external" href="http://en.wikipedia.org/wiki/JSON">JSON</a> encoded. To make it easier to
read, use &#8216;view source&#8217; and copy and paste the entire source code into
<a class="reference external" href="http://jsbeautifier.org">jsbeautifier.org</a>.</p>
<p>There is all sorts of interesting and not-so-interesting stuff in there, but
lets look right at the very bottom where you find:</p>
<div class="highlight-javascript"><div class="highlight"><pre>        <span class="s2">&quot;res&quot;</span><span class="o">:</span> <span class="p">[{</span>
            <span class="s2">&quot;d&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="s2">&quot;l&quot;</span><span class="o">:</span> <span class="s2">&quot;240p&quot;</span><span class="p">,</span>
            <span class="s2">&quot;u&quot;</span><span class="o">:</span> <span class="s2">&quot;aHR0cDovL3MxMC52aWRlb2JiLmNvbTo4MC9zP3Y9OEZ2QUc2QVFwSGk4JnQ9MTMxMzIzOTczMCZ1PSZjPUIzOUQyOThBNzY0QkNGRTdDRThFNTExRkYyRjQ3MTFEOTY0MkRBMUJGOUNBNEQ2ODA5NDkwRkNGRTAyM0UwN0Mmcj0x&quot;</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s2">&quot;d&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="s2">&quot;l&quot;</span><span class="o">:</span> <span class="s2">&quot;480p&quot;</span><span class="p">,</span>
            <span class="s2">&quot;u&quot;</span><span class="o">:</span> <span class="s2">&quot;aHR0cDovL3MxMC52aWRlb2JiLmNvbTo4MC9zP3Y9OEZ2QUc2QVFwSGk4JnQ9MTMxMzIzOTczMCZ1PSZjPUIzOUQyOThBNzY0QkNGRTdDRThFNTExRkYyRjQ3MTFEOTY0MkRBMUJGOUNBNEQ2ODA5NDkwRkNGRTAyM0UwN0Mmcj0y&quot;</span>
        <span class="p">}]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>More base64 encoded URLs? Perhaps one for each different quality? Lets try:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;aHR0cDovL3MxMC52aWRlb2JiLmNvbTo4MC9zP3Y9OEZ2QUc2QVFwSGk4JnQ9MTMxMzIzOTczMCZ1PSZjPUIzOUQyOThBNzY0QkNGRTdDRThFNTExRkYyRjQ3MTFEOTY0MkRBMUJGOUNBNEQ2ODA5NDkwRkNGRTAyM0UwN0Mmcj0x&#39;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;base-64&#39;</span><span class="p">)</span>
<span class="go">&#39;http://s10.videobb.com:80/s?v=8FvAG6AQpHi8&amp;t=1313239730&amp;u=&amp;c=B39D298A764BCFE7CE8E511FF2F4711D9642DA1BF9CA4D6809490FCFE023E07C&amp;r=1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;aHR0cDovL3MxMC52aWRlb2JiLmNvbTo4MC9zP3Y9OEZ2QUc2QVFwSGk4JnQ9MTMxMzIzOTczMCZ1PSZjPUIzOUQyOThBNzY0QkNGRTdDRThFNTExRkYyRjQ3MTFEOTY0MkRBMUJGOUNBNEQ2ODA5NDkwRkNGRTAyM0UwN0Mmcj0y&#39;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;base-64&#39;</span><span class="p">)</span>
<span class="go">&#39;http://s10.videobb.com:80/s?v=8FvAG6AQpHi8&amp;t=1313239730&amp;u=&amp;c=B39D298A764BCFE7CE8E511FF2F4711D9642DA1BF9CA4D6809490FCFE023E07C&amp;r=2&#39;</span>
</pre></div>
</div>
<p>Paste these URLs (well, the ones you get as these ones will have expired!) into
your favourite media player and you should see video!</p>
</div>
<div class="section" id="what-do-we-know">
<h2>What Do We Know?<a class="headerlink" href="#what-do-we-know" title="Permalink to this headline">¶</a></h2>
<p>At this stage, we now have enough info to write our plugin.</p>
<p>We know some URL patterns that we can resolve, we know what URL we need to
retrieve in order to find the media URLs
(<tt class="docutils literal"><span class="pre">http://videobb.com/player_control/settings.php?v={VIDEO_ID}</span></tt>),
and we know how the media URLs are encoded (base64).</p>
<p>Time to move on and write some code!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Analyse the Target Site</a><ul>
<li><a class="reference internal" href="#first-look">First Look</a></li>
<li><a class="reference internal" href="#are-we-human">Are We Human?</a></li>
<li><a class="reference internal" href="#finding-the-media-url">Finding the Media URL</a></li>
<li><a class="reference internal" href="#where-is-it-hidden">Where is it Hidden?</a></li>
<li><a class="reference internal" href="#what-do-we-know">What Do We Know?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="code.html"
                        title="next chapter">Coding the Plugin</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/resolverplugin/analyse.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="code.html" title="Coding the Plugin"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             >previous</a> |</li>
        <li><a href="../../index.html">XBMC Helper Modules v0.1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Tutorials</a> &raquo;</li>
          <li><a href="index.html" >How to Write a <tt class="docutils literal docutils literal"><span class="pre">urlresolver</span></tt> Plugin</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, t0mm0.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.1.
    </div>
  </body>
</html>